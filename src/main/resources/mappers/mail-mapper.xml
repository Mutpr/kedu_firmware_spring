<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Mail">
	<insert id="insertMail" useGeneratedKeys="true" keyProperty="mail_seq" keyColumn="MAIL_SEQ">
  		insert into mail values(mail_seq.nextval, #{mail_sender_user_seq}, #{mailbox_seq}, #{mail_title}, #{mail_content}, sysdate, sysdate, null, 'N', 'N', 'Y')
  	</insert>
  	
  	<!-- 메일 회신 -->
  	<insert id="replyMail"  useGeneratedKeys="true" keyProperty="mail_seq" keyColumn="MAIL_SEQ">
  		insert into mail values(mail_seq.nextval, #{mail_sender_user_seq}, #{mailbox_seq}, #{mail_title}, #{mail_content}, sysdate, sysdate, null, 'N', 'N', 'Y')
  	</insert>
  	
  	<!-- 메일 ID로 메일 가져오기 (회신 처리용) -->
    <select id="getMailById" resultType="com.kedu.firmware.DTO.MailDTO">
        select * from mail where mail_seq = #{mailId}
    </select>
  	
  	<!-- 모든 메일함의 첫번째 메일 목록 가져오기 -->
  	<select id="selectAll" resultType="com.kedu.firmware.DTO.MailDTO">
  		select * from mail m where mail_seq = (
  			select MIN(mail_seq) from mail where mailbox_seq = m.mailbox_seq
  		)
  		 order by m.mail_seq desc
  	</select>
  	
  	<select id="selectBySeq" resultType="com.kedu.firmware.DTO.MailDTO">
  		select * from mail where mailbox_seq = (
  			select mailbox_seq from mail where mail_seq = #{mail_seq}
  		) order by 1 desc
  	</select>
  	
  	<delete id="deleteSelectedMail">
  		delete from mail where mail_seq = #{mail_seq}
  	</delete>
  	
  	<!-- 선택된 메일 전체 삭제 -->
  	<delete id="deleteSelectedMails">
  		delete from mail where mailbox_seq = (	
			select mailbox_seq from mail where mail_seq = #{mail_seq}
		)
  	</delete>
  	
  	<select id="selectSenderInfo">
  		select * from users where user_seq = #{sender_user_seq}
  	</select>
</mapper>
